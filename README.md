# redhat-cve-fix-checker

This is a tool to figured out what CVEs have been patched in a Red Hat catalog container image. Given a registry and a
repository it will use the Red Hat [Pyxis API](https://catalog.redhat.com/api/containers/docs/) and the
[Red Hat Security API](https://access.redhat.com/documentation/en-us/red_hat_security_data_api/1.0/html-single/red_hat_security_data_api/index)
also known as "Hydra".

This tool can be used to get a list of images in a registry/repository and return all image version and what cves have been marked as fixed
in them. Also given a list of CVEs it can filter what images have the fix (this does not take rollup patching into account)

This tool prints to std out, the standard output format is json, options for a table and a csv does exist. To add to a file simply redirect stdout 
to the file of choice.

## Requirements

This code was developed with python3.9+

The required dependencies are in the requirements.txt file and can be installed via:

```shell
pip3 install --user -r requirements.txt

```

## Usage

```text
usage: rh_cve_fix_checker.py [-h] [-o {csv,table,json}] [--since SINCE] [--arch {amd64,aarch64,s390x,ppc64le}] [-e] [--cves [CVES ...]]
                             {registry.access.redhat.com,registry.connect.redhat.com} repository

A tool to identify what CVE's have been fixed in images in Red Hat's container image registries

positional arguments:
  {registry.access.redhat.com,registry.connect.redhat.com}
                        the Red Hat registry, access is for Red Hat images, connect is for partners
  repository            the repo for the image, this is can be a single image name or a path ex: (ubi8 or ubi8/ubi)

options:
  -h, --help            show this help message and exit
  -o {csv,table,json}, --output {csv,table,json}
                        output format
  --since SINCE         this is an image tag and only this image and newer will be returned, if invalid nothing will be returned
  --arch {amd64,aarch64,s390x,ppc64le}
                        only look at specific architecture
  -e, --show-existing-cve
                        Shows any known CVEs existing in each image
  --cves [CVES ...]     a space separated list of only the cves of interest, only images that fix these cves will be shown, does not take into account rollup patching
```

## Examples

```bash
## Get all registry.access.redhat.com/ubi8 (UBI 8 Fullsize) images
./rh_cve_fix_checker.py registry.access.redhat.com ubi8

## Get all registry.access.redhat.com/ubi9/ubi-micro (UBI 9 Micro Images)
./rh_cve_fix_checker.py registry.access.redhat.com ubi9/ubi-micro 

## Get all registry.access.redhat.com/ubi8 (UBI 8 Fullsize) images only for amd64 arch
./rh_cve_fix_checker.py registry.access.redhat.com ubi8 --arch amd64 

## Get the registry.access.redhat.com/ubi8 (UBI 8 Fullsize) images where CVE-2021-35938 CVE-2023-44487 are noted to be remediated. 
./rh_cve_fix_checker.py registry.access.redhat.com ubi8 --cves CVE-2021-35938 CVE-2023-44487

```
